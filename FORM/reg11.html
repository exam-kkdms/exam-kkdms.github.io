<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>CBSE XI Form Viewer</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f2f2f2; }
    input, button { padding: 10px; width: 100%; margin-bottom: 10px; }
    .form-box { background: #fff; padding: 20px; border: 1px solid #ccc; display: none; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    td, th { border: 1px solid #333; padding: 6px; vertical-align: top; }
    .signature-box { height: 60px; }
  </style>
</head>
<body>

  <h2>üìù CBSE Class XI Registration Form</h2>
  <input type="text" id="aadharInput" placeholder="Enter your Aadhar Number">
  <button onclick="getFormData()">Search</button>
  <div id="spinner" style="display:none;">üîÑ Searching...</div>
  <div id="result" class="form-box"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script>
    const apiUrl = "https://script.google.com/macros/s/AKfycbzvAMMcQwO4GQNxw9a05hdgu2ahcq1eph6YaYXMfs5Lbsc4FdTP5ui31Q5U8GR38woY/exec"; // Replace with actual script URL

    async function getFormData() {
      const aadhar = document.getElementById("aadharInput").value.trim();
      const result = document.getElementById("result");
      const spinner = document.getElementById("spinner");
      result.innerHTML = "";
      result.style.display = "none";

      if (!aadhar) {
        alert("Please enter your Aadhar number.");
        return;
      }

      spinner.style.display = "block";

      try {
        const response = await fetch(`${apiUrl}?aadhar=${encodeURIComponent(aadhar)}`);
        const data = await response.json();
        spinner.style.display = "none";

        if (data.error) {
          result.innerHTML = `<div style="color:red;">‚ùå ${data.error}</div>`;
          result.style.display = "block";
          return;
        }

        result.innerHTML = renderHTML(data) + `<button onclick="downloadPDF()">Download as PDF</button>`;
        result.style.display = "block";

      } catch (error) {
        spinner.style.display = "none";
        result.innerHTML = `<div style="color:red;">‚ùå Error fetching data.</div>`;
        result.style.display = "block";
        console.error(error);
      }
    }

    function renderHTML(d) {
      return `
        <div id="pdfContent">
          <h3>CBSE Registration Form (Class XI)</h3>
          <table>
            <tr><td><strong>Candidate Name:</strong></td><td colspan="3">${d["Name of the student :"] || ""}</td></tr>
            <tr><td><strong>Admission No.:</strong></td><td>${d["ADMISSION NO"] || ""}</td>
                <td><strong>Admission Date:</strong></td><td>${d["ADMISSION DATE :"] || ""}</td></tr>
            <tr><td><strong>Mother's Name:</strong></td><td colspan="3">${d["Mother's Name:"] || ""}</td></tr>
            <tr><td><strong>Father's Name:</strong></td><td colspan="3">${d["Father's Name:"] || ""}</td></tr>
            <tr>
              <td><strong>Sex:</strong> ${d["Sex:"] || ""}</td>
              <td><strong>Category:</strong> ${d["Category:"] || ""}</td>
              <td><strong>Handicap:</strong> ${d["Handicap:"] || ""}</td>
              <td><strong>Only Child:</strong> ${d["Only Child:"] || ""}</td>
            </tr>
            <tr>
              <td><strong>Date of Birth:</strong> ${d["Date of Birth:"] || ""}</td>
              <td><strong>Minority:</strong> ${d["Minority:"] || ""}</td>
              <td colspan="2"><strong>Religion:</strong> ${d["Religion:"] || ""}</td>
            </tr>
            <tr><td><strong>Aadhar No.:</strong></td><td colspan="3">${d["Aadhar No."] || ""}</td></tr>
            <tr>
              <td><strong>Class X Roll No.:</strong> ${d["Class X Roll No."] || ""}</td>
              <td><strong>Year:</strong> ${d["Class X Year:"] || ""}</td>
              <td colspan="2"><strong>Board:</strong> ${d["Class X Board:"] || ""}</td>
            </tr>
            <tr><th>Subject</th><th>Code</th><th colspan="2"></th></tr>
            <tr><td>${d["SUBJECT 2"] || ""}</td><td>${d["CODE 1"] || ""}</td><td colspan="2"></td></tr>
            <tr><td>${d["SUBJECT 3"] || ""}</td><td>${d["CODE 2"] || ""}</td><td colspan="2"></td></tr>
            <tr><td>${d["SUBJECT 4"] || ""}</td><td>${d["CODE 3"] || ""}</td><td colspan="2"></td></tr>
            <tr><td>${d["SUBJECT 5"] || ""}</td><td>${d["CODE 4"] || ""}</td><td colspan="2"></td></tr>
            <tr><td>${d["SUBJECT 6"] || ""}</td><td>${d["CODE 5"] || ""}</td><td colspan="2"></td></tr>
            <tr>
              <td class="signature-box"><strong>Student's Signature</strong></td>
              <td class="signature-box"><strong>Father's Signature</strong></td>
              <td class="signature-box"><strong>Mother's Signature</strong></td>
              <td class="signature-box"><strong>Principal's Signature</strong></td>
            </tr>
          </table>
        </div>
      `;
    }

    function downloadPDF() {
      html2pdf().from(document.getElementById("pdfContent")).save("CBSE_Registration_Form.pdf");
    }
  </script>

</body>
</html>
