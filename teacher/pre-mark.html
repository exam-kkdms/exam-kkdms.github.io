<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Marks Viewer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        .icon {
            width: 20px;
            height: 20px;
            display: inline-block;
            vertical-align: middle;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50">
    <div class="p-2 sm:p-4">
        <div class="max-w-6xl mx-auto">
            <!-- Header -->
            <div class="bg-white rounded-xl shadow-lg p-3 sm:p-6 mb-3 sm:mb-4">
                <div class="flex items-center gap-2 mb-1">
                    <svg class="w-6 h-6 sm:w-8 sm:h-8 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                    </svg>
                    <h1 class="text-xl sm:text-3xl font-bold text-gray-800">Student Marks Viewer</h1>
                </div>
                <p class="text-xs sm:text-base text-gray-600 ml-8 sm:ml-11">Select class and subject to view student marks</p>
            </div>

            <!-- Controls -->
            <div class="bg-white rounded-xl shadow-lg p-3 sm:p-6 mb-3 sm:mb-4">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                    <!-- Class Selection -->
                    <div>
                        <label class="block text-xs sm:text-sm font-semibold text-gray-700 mb-1 sm:mb-2">Class</label>
                        <select id="classSelect" class="w-full px-3 py-2 sm:px-4 sm:py-3 text-sm border-2 border-gray-200 rounded-lg focus:border-indigo-500 focus:outline-none transition-colors">
                            <option value="X">X</option>
                            <option value="XII" selected>XII</option>
                        </select>
                    </div>

                    <!-- Subject Selection -->
                    <div>
                        <label class="block text-xs sm:text-sm font-semibold text-gray-700 mb-1 sm:mb-2">Subject</label>
                        <select id="subjectSelect" class="w-full px-3 py-2 sm:px-4 sm:py-3 text-sm border-2 border-gray-200 rounded-lg focus:border-indigo-500 focus:outline-none transition-colors">
                        </select>
                    </div>

                    <!-- Fetch Button -->
                    <div class="flex items-end">
                        <button id="fetchBtn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 sm:py-3 sm:px-6 text-sm rounded-lg transition-colors flex items-center justify-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                            <span id="btnText">Fetch Marks</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Error Message -->
            <div id="errorMessage" class="hidden bg-red-50 border-2 border-red-200 rounded-xl p-3 mb-3 sm:mb-4 flex items-center gap-2">
                <svg class="w-4 h-4 sm:w-5 sm:h-5 text-red-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <p class="text-red-700 text-xs sm:text-base" id="errorText"></p>
            </div>

            <!-- Data Table -->
            <div id="dataTable" class="hidden bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="bg-gradient-to-r from-indigo-600 to-purple-600 px-3 py-3 sm:px-6 sm:py-4 flex items-center gap-2">
                    <svg class="w-4 h-4 sm:w-5 sm:h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                    </svg>
                    <h2 class="text-base sm:text-xl font-bold text-white">Student Records (<span id="recordCount">0</span>)</h2>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="bg-gray-50 border-b-2 border-gray-200">
                                <th class="px-2 py-2 sm:px-4 sm:py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">#</th>
                                <th class="px-2 py-2 sm:px-4 sm:py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Student Name</th>
                                <th class="px-2 py-2 sm:px-4 sm:py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider">Roll Number</th>
                                <th class="px-2 py-2 sm:px-4 sm:py-3 text-center text-xs font-bold text-gray-700 uppercase tracking-wider">Marks</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody" class="divide-y divide-gray-200">
                        </tbody>
                    </table>
                </div>

                <!-- Legend -->
                <div class="bg-gray-50 px-3 py-3 sm:px-6 sm:py-4 border-t border-gray-200">
                    <div class="flex flex-wrap gap-2 sm:gap-4 items-center text-xs sm:text-sm">
                        <span class="font-semibold text-gray-700">Legend:</span>
                        <div class="flex items-center gap-1 sm:gap-2">
                            <span class="inline-block px-2 py-1 sm:px-3 bg-red-100 text-red-700 font-semibold rounded text-xs">AB</span>
                            <span class="text-gray-600">= Absent</span>
                        </div>
                        <div class="flex items-center gap-1 sm:gap-2">
                            <span class="inline-block px-2 py-1 sm:px-3 bg-yellow-100 text-yellow-700 font-semibold rounded text-xs">NA</span>
                            <span class="text-gray-600">= Not Available</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="bg-white rounded-xl shadow-lg p-6 sm:p-12 text-center">
                <svg class="w-12 h-12 sm:w-16 sm:h-16 text-gray-300 mx-auto mb-3 sm:mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                </svg>
                <h3 class="text-lg sm:text-xl font-semibold text-gray-700 mb-1 sm:mb-2">No Data Yet</h3>
                <p class="text-xs sm:text-base text-gray-500">Select a class and subject, then click "Fetch Marks" to view student records.</p>
            </div>
        </div>
    </div>

    <script>
        const subjectOptions = {
            'X': [
                'English',
                'Bengali',
                'Hindi',
                'Science',
                'SST',
                'IT',
                'Math'
            ],
            'XII': [
                '301 ENGLISH CORE',
                '055 ACCOUNTANCY',
                '043 CHEMISTRY',
                '029 GEOGRAPHY',
                '048 PHYSICAL EDUCATION',
                '041 MATHEMATICS',
                '027 HISTORY',
                '002 HINDI ELECTIVE',
                '105 BENGALI',
                '054 BUSINESS STUDIES',
                '042 PHYSICS',
                '028 POLITICAL SCIENCE',
                '030 ECONOMICS',
                '044 BIOLOGY',
                '039 SOCIOLOGY',
                '083 COMPUTER SCIENCE',
                '052 APP/COMMERCIAL ART'
            ]
        };

        const classSelect = document.getElementById('classSelect');
        const subjectSelect = document.getElementById('subjectSelect');
        const fetchBtn = document.getElementById('fetchBtn');
        const btnText = document.getElementById('btnText');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');
        const dataTable = document.getElementById('dataTable');
        const emptyState = document.getElementById('emptyState');
        const tableBody = document.getElementById('tableBody');
        const recordCount = document.getElementById('recordCount');

        function updateSubjects() {
            const selectedClass = classSelect.value;
            subjectSelect.innerHTML = '';
            subjectOptions[selectedClass].forEach(subject => {
                const option = document.createElement('option');
                option.value = subject;
                option.textContent = subject;
                subjectSelect.appendChild(option);
            });
        }

        function getMarkStyle(mark) {
            if (mark === 'AB') return 'bg-red-100 text-red-700 font-semibold';
            if (mark === 'NA') return 'bg-yellow-100 text-yellow-700 font-semibold';
            return 'text-gray-900 font-medium';
        }

        async function fetchData() {
            const selectedClass = classSelect.value;
            const selectedSubject = subjectSelect.value;
            
            btnText.textContent = 'Loading...';
            fetchBtn.disabled = true;
            errorMessage.classList.add('hidden');
            dataTable.classList.add('hidden');
            emptyState.classList.add('hidden');

            try {
                const encodedSubject = encodeURIComponent(selectedSubject);
                const url = `https://script.google.com/macros/s/AKfycbzRnsp6PsWaDWD5gCKd47JNgrHfYfoiqO2_38wY2EW9XBDkwYCJlwSGGCgWyXMTKVP6/exec?class=${selectedClass}&subject=${encodedSubject}`;
                
                const response = await fetch(url);
                if (!response.ok) throw new Error('Failed to fetch data');
                
                const jsonData = await response.json();
                const filteredData = jsonData.filter(student => student.marks !== null);
                
                if (filteredData.length > 0) {
                    displayData(filteredData);
                } else {
                    emptyState.classList.remove('hidden');
                }
            } catch (err) {
                errorText.textContent = err.message;
                errorMessage.classList.remove('hidden');
                emptyState.classList.remove('hidden');
            } finally {
                btnText.textContent = 'Fetch Marks';
                fetchBtn.disabled = false;
            }
        }

        function displayData(data) {
            tableBody.innerHTML = '';
            recordCount.textContent = data.length;
            
            data.forEach((student, index) => {
                const [name, rollNo] = student.name.split(' - ');
                const row = document.createElement('tr');
                row.className = 'hover:bg-indigo-50 transition-colors';
                row.innerHTML = `
                    <td class="px-2 py-2 sm:px-4 sm:py-3 text-xs sm:text-sm text-gray-600">${index + 1}</td>
                    <td class="px-2 py-2 sm:px-4 sm:py-3 text-xs sm:text-sm font-medium text-gray-900">${name}</td>
                    <td class="px-2 py-2 sm:px-4 sm:py-3 text-xs sm:text-sm text-gray-600">${rollNo}</td>
                    <td class="px-2 py-2 sm:px-4 sm:py-3 text-center">
                        <span class="inline-block px-2 py-1 sm:px-4 sm:py-2 text-xs sm:text-sm rounded-lg ${getMarkStyle(student.marks)}">
                            ${student.marks}
                        </span>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            dataTable.classList.remove('hidden');
        }

        classSelect.addEventListener('change', updateSubjects);
        fetchBtn.addEventListener('click', fetchData);

        // Initialize subjects
        updateSubjects();
    </script>
</body>
</html>