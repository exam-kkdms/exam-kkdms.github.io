<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Syllabus Viewer</title>
  <style>
    body {
      font-family: Arial;
      background: #f4f4f4;
      padding: 20px;
    }
    .form-container {
      background: white;
      padding: 20px;
      max-width: 500px;
      margin: auto;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    select, button {
      padding: 10px;
      width: 100%;
      margin-bottom: 10px;
    }
    .subject-card {
      background: white;
      margin: 20px auto;
      padding: 15px;
      max-width: 900px;
      border-radius: 10px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 8px;
      text-align: left;
    }
    .mark-table {
      margin-top: 10px;
    }
  </style>
</head>
<body>

<div class="form-container">
  <h2>Select Class</h2>
  <select id="class">
    <option value="">Select Class</option>
    <option>Balvatika 1</option>
    <option>Balvatika 2</option>
    <option>Balvatika 3</option>
    <option>Class 1</option>
    <option>Class 2</option>
    <option>Class 3</option>
    <option>Class 4</option>
    <option>Class 5</option>
    <option>Class 6</option>
    <option>Class 7</option>
    <option>Class 8</option>
    <option>Class 9</option>
    <option>Class 10</option>
    <option>Class 11</option>
    <option>Class 12</option>
  </select>
  <button onclick="fetchSyllabus()">Submit</button>
</div>

<div id="output"></div>

<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbwZQqP4A5j6yjxiDCRLddhZG0gCsKFC5EF6CsZ7OmH8ejSVi_LWiZrzk233anJOGE0CZQ/exec"; // Replace with your deployed script URL

  async function fetchSyllabus() {
    const classVal = document.getElementById("class").value;
    const output = document.getElementById("output");
    output.innerHTML = "";

    if (!classVal) {
      output.innerHTML = "<p style='color:red;'>Please select a class.</p>";
      return;
    }

    try {
      const url = `${API_URL}?class=${encodeURIComponent(classVal)}`;
      const res = await fetch(url);
      const data = await res.json();

      if (!data.length) {
        output.innerHTML = "<p style='color:red;'>No data found for selected class.</p>";
        return;
      }

      data.forEach(item => {
        const card = document.createElement("div");
        card.className = "subject-card";
        card.innerHTML = `
          <h3>${item.SUBJECT}</h3>
          <p><strong>Teacher:</strong> ${item.TEACHER || "N/A"}</p>
          <p><strong>Syllabus:</strong><br>${(item.SYLLABUS || "").replace(/\n/g, "<br>")}</p>
          <div class="mark-table">
            <h4>Mark Distribution</h4>
            <table>
              <tr>
                <th>Mark</th>
                <th>No. of Questions</th>
                <th>OR Questions</th>
              </tr>
              ${buildMarkRows(item)}
              <tr style="background:#eee;">
                <td colspan="3"><strong>Total Marks:</strong> ${calculateTotalMarks(item)}</td>
              </tr>
            </table>
          </div>
        `;
        output.appendChild(card);
      });
    } catch (err) {
      console.error(err);
      output.innerHTML = "<p style='color:red;'>Error fetching data.</p>";
    }
  }

  function buildMarkRows(item) {
    const rows = [];
    for (let i = 0; i < 5; i++) {
      const mark = item[`Select Mark${i ? " " + i : ""}`];
      const questions = item[`No of Questions${i ? " " + i : ""}`];
      const orQ = item[`No. of OR Question (If any)${i ? " " + i : ""}`];
      if (mark && questions) {
        rows.push(`
          <tr>
            <td>${mark}</td>
            <td>${questions}</td>
            <td>${orQ || 0}</td>
          </tr>
        `);
      }
    }
    return rows.join("");
  }

  function calculateTotalMarks(item) {
    let total = 0;
    for (let i = 0; i < 5; i++) {
      const mark = Number(item[`Select Mark${i ? " " + i : ""}`]);
      const questions = Number(item[`No of Questions${i ? " " + i : ""}`]);
      if (!isNaN(mark) && !isNaN(questions)) {
        total += mark * questions;
      }
    }
    return total;
  }
</script>

</body>
</html>
